---
- name: Get Disk Usage
  ansible.windows.win_powershell:
    script: |
      $disk = Get-WmiObject Win32_LogicalDisk -Filter "DeviceID='C:'" | Select-Object Size, FreeSpace
      $total = $disk.Size
      $free = $disk.FreeSpace
      $usage = [math]::Round((($total - $free) / $total) * 100, 2)
      $usage
  register: usage

- name: Display Disk Usage
  debug:
    var: usage

- name: Display content
  set_fact:
    report_content: "{{report_content + [usage.output]}}"
  delegate_to: DCy

- name: Building the template
  debug:
    var: report_content
  delegate_to: DC
  run_once: yes