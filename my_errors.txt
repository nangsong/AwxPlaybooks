---
- hosts: all 
  gather_facts: yes
  tasks:
    - name: Creating folder
      win_file:
        path: C:\mdeupdate\  
        state: directory
      no_log: true

    - name: Copy agent files to server
      ansible.windows.win_copy:
        src: \\FCQ4WSCCMDP01\mde_update\
        dest: C:\mdeupdate\
        remote_src: true
      no_log: false
      when: ('bocqa' in ansible_nodename) and ('9W' not in ansible_hostname)

    - name: Copy agent files to server
      ansible.windows.win_copy:
        src: \\FCQ9WSCCMDP01\mde_update\
        dest: C:\mdeupdate\
        remote_src: true
      no_log: false
      when: ('bocqa' in ansible_nodename) and ('9W' in ansible_hostname)
      
    
    - name: Run the agent installation command
      win_command: mde_update.exe
      args:
        chdir: 'C:\mdeupdate'

    - name: Delete the local CBSP directory
      win_file:
        path: C:\mdeupdate\
        state: absent
      no_log: true
