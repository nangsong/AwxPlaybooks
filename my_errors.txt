
â¸»

âœ… Part 1: Removing a Node from the Cluster

âš ï¸ Pre-checks before removing a node:

	â€¢	Ensure the node has no active cluster roles (move them to another node).
	â€¢	Ensure quorum will not be lost if the node is removed.
	â€¢	Validate cluster health before making changes.

Step-by-step:
	1.	Open Failover Cluster Manager (FCM)
	â€¢	On any node, open Failover Cluster Manager.
	2.	Connect to Cluster (if not already connected)
	â€¢	Right-click on Failover Cluster Manager, choose â€œConnect to Clusterâ€, and select your cluster name.
	3.	Drain Roles (if any are running on the node)
	â€¢	Expand the cluster name â†’ go to Nodes
	â€¢	Right-click on the node to remove â†’ â€œPauseâ€ > â€œDrain Rolesâ€
	â€¢	Wait for all roles to move.
	4.	Pause and Evict the Node
	â€¢	Right-click on the node again â†’ â€œMore Actionsâ€ > â€œEvictâ€
	â€¢	Confirm the eviction.
	5.	Verify Node Removal
	â€¢	The node should disappear from the Nodes section.
	â€¢	Review cluster events and validation to ensure no issues occurred.

â¸»

âœ… Part 2: Adding the Node Back to the Cluster

âš ï¸ Pre-checks before adding a node:

	â€¢	Ensure the node has:
	â€¢	Same Windows Server OS version and patch level.
	â€¢	Cluster feature installed (Failover-Clustering feature).
	â€¢	Proper DNS resolution and firewall settings.
	â€¢	All necessary storage/network access.
	â€¢	Optional but recommended: Run â€œValidate Clusterâ€ before adding.

Step-by-step:
	1.	Install Failover Clustering Feature (if not installed)
On the node:

Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools -Restart

	2.	Open Failover Cluster Manager
	â€¢	On any node thatâ€™s already part of the cluster.
	3.	Connect to the Cluster (if not already)
	â€¢	Right-click Failover Cluster Manager, choose â€œConnect to Clusterâ€, select your cluster.
	4.	Add Node to Cluster
	â€¢	Right-click Nodes â†’ â€œAdd Nodeâ€
	â€¢	Type the hostname of the node you want to add.
	5.	Validation Wizard (Recommended)
	â€¢	It will prompt you to run cluster validation.
	â€¢	Choose Yes and run â€œRun only tests I selectâ€ or â€œRun all testsâ€ for thorough validation.
	6.	Complete the Wizard
	â€¢	Once validation passes, follow the prompts to add the node.
	7.	Verify Node Addition
	â€¢	Ensure the node appears under Nodes.
	â€¢	Verify it shows as Up and Running.
	â€¢	Optionally Resume the node if itâ€™s paused.
	8.	Test Cluster Role Failover (optional but recommended)
	â€¢	Move a role to the newly added node to verify its functionality.

ðŸ›¡ï¸ Post Steps & Best Practices
	â€¢	Monitor Event Viewer for cluster-related logs.
	â€¢	Monitor Failover Cluster Manager for health.
	â€¢	Consider resuming cluster-aware backups/monitoring/patching tools on the added node.

âœ… Steps to Drain a Node (Without Eviction)

1. Open Failover Cluster Manager
	â€¢	Open Failover Cluster Manager on any cluster node or your management workstation.
	â€¢	Connect to the relevant cluster if not already connected.

2. Navigate to Nodes
	â€¢	Expand the cluster name â†’ Click on Nodes.

3. Pause and Drain the Node
	â€¢	Right-click the node you want to drain.
	â€¢	Select:
â€œPauseâ€ > â€œDrain Rolesâ€

This action will:
	â€¢	Move all cluster roles (VMs, file shares, SQL instances, etc.) to other nodes.
	â€¢	Mark the node as Paused, so it wonâ€™t receive new workloads until resumed.

4. Verify Roles Were Moved
	â€¢	Go to Roles in the left pane.
	â€¢	Check that all roles are now running on other nodes.

5. (Optional) Perform Maintenance
	â€¢	You can now safely:
	â€¢	Patch the node.
	â€¢	Reboot it.
	â€¢	Perform updates or diagnostics.

âœ… Resuming the Node After Maintenance

Once youâ€™re done:

6. Resume the Node
	â€¢	Go back to Nodes, right-click the paused node.
	â€¢	Choose:
â€œResumeâ€ > â€œDo Not Fail Roles Backâ€ (recommended to avoid unnecessary failovers)
OR
â€œResumeâ€ > â€œFail Roles Backâ€ (if you want the roles to return to the original node).

âœ… Steps to Set Node Priority (Preferred Owners) Using Failover Cluster Manager

1. Open Failover Cluster Manager
	â€¢	Open Failover Cluster Manager.
	â€¢	Connect to your cluster if not already connected.

2. Navigate to Roles
	â€¢	In the left pane, expand your cluster and click on Roles.
	â€¢	Youâ€™ll see the list of clustered roles (VMs, file servers, SQL instances, etc.).

3. Right-click the Role You Want to Prioritize
	â€¢	Select Properties.

4. Go to the â€˜Preferred Ownersâ€™ Tab
	â€¢	In the Properties window, go to the â€œPreferred Ownersâ€ tab.

5. Set Node Priority
	â€¢	Youâ€™ll see a list of all cluster nodes.
	â€¢	Check the boxes next to nodes you want to allow as preferred owners.
	â€¢	Reorder them using Move Up / Move Down â€” the node at the top will have the highest priority.
âš ï¸ If a role fails, the cluster will try nodes in this order.

6. Apply the Changes
	â€¢	Click OK or Apply to confirm.

âœ… PowerShell to Drain a Cluster Node
Suspend-ClusterNode -Name "NodeName" -Drain

This will:
	â€¢	Pause the node (ClusterNode01) in the cluster.
	â€¢	Live migrate all roles (e.g., clustered VMs, SQL instances, etc.) to other nodes.
	â€¢	Prevent any new roles from being moved to that node.

ðŸ§  Check Node Status After Drain
Get-ClusterNode -Name "ClusterNode01" | Format-List Name, State, NodeWeight

âœ… PowerShell to Resume the Node (After Maintenance)
Resume-ClusterNode -Name "ClusterNode01" -Failback None

Use -Failback None to resume the node without moving roles back (recommended).
Use -Failback Immediate if you want roles to return to that node 



Get-WinEvent -LogName System -FilterHashtable @{Id=1074} -MaxEvents 1 | 
Select-Object TimeCreated,
              @{Name='User'; Expression={$_.Properties[6].Value}},
              @{Name='Process'; Expression={$_.Properties[0].Value}},
              @{Name='Reason'; Expression={$_.Properties[2].Value}},
              @{Name='Comment'; Expression={$_.Properties[5].Value}}
&&&&&&&&&&&&&&&&&&$$$$$$$$$$$$$$$$$$@@@@@@nangsonghermann@gmail.com

To prevent users from checking for or installing updates manually when they log in to Windows Servers (and instead maintain centralized control via WSUS, SCCM, or Ansible), you can configure a Group Policy Object (GPO) that:
	1.	Disables access to Windows Update in the Settings app.
	2.	Prevents manual installation of updates.
	3.	Ensures update settings are enforced centrally.

Hereâ€™s a step-by-step guide to configure such a GPO:

â¸»

1. Create a New GPO
	â€¢	Open Group Policy Management Console (GPMC).
	â€¢	Right-click the OU or domain where your servers are located.
	â€¢	Choose â€œCreate a GPO in this domain, and Link it hereâ€¦â€.
	â€¢	Name it something like: Server_Restrict_Updates.

â¸»

2. Edit the GPO

Right-click the GPO you just created > Edit.

â¸»

3. Configure Windows Update Restrictions

Go to:
Computer Configuration > Administrative Templates > Windows Components > Windows Update

Enable the following policies:

A. Remove Access to Use All Windows Update Features
	â€¢	Policy Name: Remove access to use all Windows Update features
	â€¢	Path:
Computer Configuration > Administrative Templates > Windows Components > Windows Update


	â€¢	Setting: Enabled
	â€¢	Option: Users will not be able to access Windows Update

B. Configure Automatic Updates
	â€¢	Policy Name: Configure Automatic Updates
	â€¢	Setting: Enabled
	â€¢	Choose option 4 - Auto download and schedule the install
	â€¢	Set scheduled install day/time (this can also be controlled via WSUS/SCCM/Ansible if applicable)

C. Do Not Connect to Any Windows Update Internet Locations
	â€¢	Path:
Computer Configuration > Administrative Templates > Windows Components > Windows Update


	â€¢	Setting: Enabled
(Prevents fallback to Microsoft Update even if WSUS is unavailable)

â¸»

4. Optional: Prevent Access to Settings UI

To go a step further, disable access to the â€œUpdate & Securityâ€ section in the Settings app:
	â€¢	Path:
User Configuration > Administrative Templates > Control Panel > Personalization


	â€¢	Policy: Prohibit access to Control Panel and PC settings
	â€¢	Setting: Enabled

Or more targeted:
	â€¢	Path:
User Configuration > Administrative Templates > Start Menu and Taskbar

Policy: Disable setting page visibility
	â€¢	Setting: Enabled
	â€¢	Value: hide:windowsupdate

â¸»

5. Link and Apply the GPO
	â€¢	Link the GPO to the correct OU where the target Windows Servers reside.
	â€¢	Run gpupdate /force on a test server.
	â€¢	Log in with a user account and verify that:
	â€¢	Windows Update is inaccessible.
	â€¢	Manual check for updates is blocked.
	â€¢	Settings are greyed out or hidden.

â¸»

6. Use WSUS or Automation Tools for Patching
	â€¢	Now that manual updates are blocked, use:
	â€¢	WSUS to approve and schedule patches.
	â€¢	SCCM for fine-grained patch deployment.
	â€¢	Ansible to automate and report patch status (as youâ€™re already building a patching solution with Ansible).

â¸»

Notes:
	â€¢	Apply this only to servers, not workstations.
	â€¢	Test the GPO in a non-production OU first.
	â€¢	This method does not block updatesâ€”it blocks users from manually triggering them.

Let me know if youâ€™d like a ready-made .admx GPO backup or an Ansible role to validate this GPO is applied across your estate.



